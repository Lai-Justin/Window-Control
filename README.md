# Automated Temperature-based Window Control Software

## Code Setup
### Install All Dependencies
pip install gpiozero
pip install RPi.GPIO
pip install jsonlines

### Temperature Sensor
git clone https://github.com/adafruit/Adafruit_Python_DHT.git

cd Adafruit_Python_DHT/

sudo apt  install -y build-essential python3-dev 

sudo python3 setup.py install

### To Run
python3 main.py

Pip3 install pandas

Pip3 install flask

To Run Web App

Python3 app.py

## Problem Overview
Climate change, as defined by the United Nations, “refers to long-term shifts in temperature and weather patterns.” Since the late 1800s, the mean global temperature has increased by 1.1°C, which although not perceived to be a massive change in temperature to our skin, this increase in temperature has led to an increase in climate/weather disasters around the globe. In particular, I decided to focus on finding a solution to help mitigate the human cost of heat waves, especially in places where extreme heat was historically not a common phenomenon, and because of this inexperience and unpreparedness, are the most vulnerable to the increasing amount of fatal heat waves

This IoT device was inspired by the deadly European heat waves and droughts during the summer of 2022, which were reported to have directly caused the deaths of 24,000 people in Europe as well as a Eurostat report stating that the heat wave directly or indirectly led to 53,000 excess deaths in Europe, an excess death rate which was far higher than the number of excess deaths attributed to Covid during the same period in 2020 and 2021 in Europe, which goes to show how deadly these heat waves could be if unprepared. Beyond just the extreme heat, a major factor that contributed to this high fatality rate is the fact that many homes and apartments in Europe, particularly in more northern and central parts of the continent, are constructed with high degrees of insulation. While this is helpful during their harsh winters to retain heat inside their apartments and homes, this also has the unintended consequence of trapping heat indoors during the increasingly hot summers. Along with this, many parts of Europe do not normally experience extreme heat, which as a result, leads to only 10% of homes in Europe owning an air conditioning unit, according to an MIT Technology Review article. While this has historically not been a problem in Europe, this has left many defenseless against the increasing amount of heat waves. To combat the extreme heat, residents in Europe have turned to other methods to keep cool, such as by keeping their windows open at night to allow for cooler air to enter their households and then closing their windows during the day to trap the cooler air inside and keep the warmer air outside from getting inside. One issue with this solution, however, is that the elderly, who are the most vulnerable to heat-related maladies according to an Environmental Protection Agency report on heat-related deaths, are sometimes not able to comfortably open and close windows without physical assistance.

## Methods and Solutions
A potential way to solve the heating of the house is by opening and closing windows based on indoor and outdoor temperatures. Observing that there is usually a difference between the temperature outdoors and the indoors, this can be utilized to help solve the problem of the house being hotter than the outdoors. We then can develop a method where the windows are opened at certain times when there is a massive difference in temperature between the indoors and outdoors and tracking when the temperature is colder outdoors than indoors and vice versa. We can then use this information to decide how wide to open the window. With a weather API providing temperature and wind direction, the device can open the window in a way that will maximize the amount of cold air entering the room. It will also be able to close the window if outdoor temperatures are hotter than the indoor temperature which will prevent the room from getting hotter than outdoor. The collected data can also be provided to other parts of the windows such as the blinds. The device will be able to control the blinds based on the direction of the sun to help prevent the sun from shining in the room and heating the room.
The device will be using a weather API to retrieve data about the temperature wind speed and direction and precipitation. The API is from the National Weather Service and returns a JSON with all the information that is needed about the outdoor weather in our area. By grabbing the device’s current IP address, the software will then be able to reference a geolocation API in order to grab the exact longitude and latitude of the device. With the coordinates, this can be used to make a get request from the National Weather Service API which will return a JSON object, containing a complete weather report with important information such as temperature, wind speed, wind direction, and precipitation from which the software will then make an informed decision on whether or not to open or close the window. By repeating this process on an hourly basis, the device will be able to maintain as cool of an indoor temperature as possible throughout the day given the weather conditions.
As for hardware, this project required a lightweight and power-efficient computer that could easily be concealed to not affect the aesthetics or possible space constraints near windows. For this, it was decided to use a Raspberry Pi, which also made it very simple to use other hardware components needed for the weather and window opening mechanisms, such as temperature sensors, motors, and batteries. With all hardware components gathered and connected together, it was simple enough to follow along with documentation and online guides to receive accurate and reliable temperature readings from the sensor. Expanding on this, I then built a database where these temperature readings could then be logged so that potential temperature patterns could then be used to better understand when to open or close the window. 
For the window movement mechanism, was simple DC motor was used, connected to the Raspberry Pi via a few resistors and an external battery to power the motor since the Raspberry Pi’s five-voltage power constraint was not powerful enough to power a motor. With this done, I had to develop certain conditions on which the motor should power on or off and in which direction to open the window. Firstly, I had to test the length of time the motor needed to move to completely open or close a specific window to not move the motor too much. Next, the temperature sensor will check the ambient temperature, and by comparing it with the outdoor temperature gained from the National Weather Service API, the program will then decide on whether or not to move the motor, which will in turn open or close the window. As well as just temperature, the program also takes into account other variables such as precipitation and wind since that may affect whether or not the user would like to have the window open or close.
Lastly, the weather data and temperature data will then be outputted onto a CSV, which can then be used to monitor the weather and see potential patterns as to when the windows should be opened or when it would be closed. This information can be used to learn certain parameters and make a more informed decision on when to open or close the window. As well as this, this data is also fed into a Flask web application to be displayed in a table for easy viewing and analysis.

## Challenges
Throughout the entire process of building the automated window control software, numerous issues and problems arose that set back my established timeline for building the device, especially as it was the first time that I had used a Raspberry Pi and was new to all of the quirks and features. Firstly was setting up wifi for the Raspberry Pi, which was critical to the main functionality of the device as it needed to receive weather information from the National Weather Service API via the internet in order to make an informed decision on whether to open or close the window. During the setup process for the Raspberry Pi, it is necessary to connect the Raspberry Pi to another computer with an ethernet cable to set up the network settings on the Raspberry Pi and to establish a proper internet connection on the Raspberry Pi. However, some issues prevented this from happening smoothly. For example, when connecting the Raspberry Pi to my Macbook, my Macbook failed to detect the Raspberry Pi, as well as some other laptops that I could get my hands on, and thus, the Raspberry Pi could not connect to the internet. After realizing that the ethernet cable that I was using was simply faulty, I soon ran into another problem, which was that I was unable to SSH into the Raspberry Pi. Whenever I tried to SSH into the Pi, it would always return an error message saying that the connection was refused, despite following official documentation and reputable guides. After seeking external help from people more experienced with Raspberry Pis, it was discovered that while trying to SSH, the SSH process, for one reason or another, was trying to connect to the wrong port number.

Another challenge that plagued the development process was the fact that the temperature sensor that was installed in the Raspberry Pi was not very accurate, nor was it very sensitive, which was vital for the success of the device. One of the features that I was hoping to implement in the device was the ability to track patterns of abnormal changes in indoor temperatures so that the device could try to account for temperature differences and changes attributed to the user. For example, this could be if the user had a habit of cooking at precisely the same time of the day every day or simply turning on other devices that would heat the living area, from which our device could then respond to these changes earlier by opening the window prematurely if the outdoor temperature is going to be cooler than the indoor temperature during and after cooking. The problem with trying to implement this, however, was that the temperature sensor was not sensitive enough to detect small temperature changes. While testing the sensor and trying to collect temperature data in a bedroom, the temperature sensor only recorded a 1°C change in temperature during a 24-hour period, which should not be correct. As well as this, I noticed that the temperature sensor was only recording the temperature to the nearest whole number, and because the sensor was also recording the temperature in Celsius, this made the sensor only able to track big temperature changes.
